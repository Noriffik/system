# Что изменилось

- больше не нужен атрибут `[Plugin]`, достаточно унаследоваться от базового класса
- порядок инициализации
  - конструкторы всех плагинов,
  - конструктор контекста (получает коллекцию плагинов)
  - плагинам дается экземпляр контекста
  - инициализация плагинов (считать, что все остальные не инициализированы)
  - запуск плагинов (считать, что все остальные инициализированы)
    ...
  - остановка плагинов
- события - синхронные/асинхронные (определяет плагин) `SafeInvoke`
- подписка на события вручную
- `Context.Using`, `Context.Require`, `GetAllPlugins<T>`
- Database 
  - теперь в виде плагина, 
  - работает на EF
  - не нужно делать все поля виртуальными, 
  - конфигурация через интерфейс, 
  - инициализируется на PluginInit
  - для миграций портирован ECM7.Migrator
- Таймеры
  - нет атрибутов, регистрация таймеров руками с заданным интервалом (нужно реализовать интерфейс)
- регистрация скриптовых команд через интерфейс (нужно приведение типов)
- из скриптов можно возвращать данные (написать return ...)
- runScript => host.scripts.scriptName(args)
- executeMethod => host.api.methodName(args)
- logInfo, logError => host.log.trace/debug/info/warn/error/fatal
- API для работы с конфигами: Microsoft.Extensions.Configuration (хелперы: Microsoft.Extensions.Configuration.Binder)
- конфиг приходит в метод Init
- настройки плагинов в разделе "plugins:<полное название класса плагина>"
- Listener => WebServer
- веб-сервер - теперь Kestrel
- порт веб-сервера в настройке `port`
  
  
## Правила
- должен быть README
- При добавлении сущностей выпускаем новую минорную версию плагина, при изменении/удалении сущностей - мажорную версию
- При выпуске мажорной версии плагина нужно слить миграции последней мажорной версии в одну (с последним номером)??

## README

*название пакета*
\# Название плагина

- плагины
  - описание + UI
  - .NET API (methods + events)
  - script API (methods + events)
  - HTTP API
  - параметры конфига
